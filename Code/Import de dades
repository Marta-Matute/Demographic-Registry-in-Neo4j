# Eliminem els possibles nodes que puguin existir previament
MATCH (p:PERSON)
DETACH DELETE p
MATCH (h:HABITATGE)
DETACH DELETE h

# Importem les dades de les persones 
LOAD CSV WITH HEADERS FROM 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTfU6oJBZhmhzzkV_0-avABPzHTdXy8851ySDbn2gq32WwaNmYxfiBtCGJGOZsMgCWjzlEGX4Zh1wqe/pub?output=csv' AS row  
CREATE (:PERSON {Id: toInteger(row.Id), Year: toInteger(row.Year), Name: row.name, Surname: row.surname, Second_Surname: row.second_surname })

# Importem les dades de l'habitatge
LOAD CSV WITH HEADERS FROM 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT0ZhR6BSO_M72JEmxXKs6GLuOwxm_Oy-0UruLJeX8_R04KAcICuvrwn2OENQhtuvddU5RSJSclHRJf/pub?output=csv' AS row
CREATE (:HABITATGE {Municipi: row.Municipi, Id_Llar: toInteger(row.Id_Llar), Year_Padro: toInteger(row.Any_Padro), Carrer: row.Carrer, Numero: toInteger(row.Numero)})

# Creem la relació VIU entre les persones i l'habitatge
LOAD CSV WITH HEADERS FROM 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRM4DPeqFmv7w6kLH5msNk6_Hdh1wuExRirgysZKO_Q70L21MKBkDISIyjvdm8shVixl5Tcw_5zCfdg/pub?output=csv' AS row
MERGE (p:PERSON {Id: row.IND})
MERGE (h:HABITATGE {Municipi:row.Location, Year_Padro: row.Year, Id_Llar: row.HOUSE_ID})
MERGE (p)-[:VIU]->(h)

# Creem la relació SAME_AS entre les diferents persones
LOAD CSV WITH HEADERS FROM 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTgC8TBmdXhjUOPKJxyiZSpetPYjaRC34gmxHj6H2AWvXTGbg7MLKVdJnwuh5bIeer7WLUi0OigI6wc/pub?output=csv' AS row 
MERGE (p:PERSON {Id: toInteger(row.Id_A)})
MERGE (q:PERSON {Id: toInteger(row.Id_B)})
MERGE (p)-[:SAME_AS]->(q)

# Creem la relació FAMILIA amb les seves propietats entre les diferents persones
LOAD CSV WITH HEADERS FROM 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRVOoMAMoxHiGboTjCIHo2yT30CCWgVHgocGnVJxiCTgyurtmqCfAFahHajobVzwXFLwhqajz1fqA8d/pub?output=csv' AS row 
MERGE (p:PERSON {Id: toInteger(row.ID_1)})
MERGE (q:PERSON {Id: toInteger(row.ID_2)})
MERGE (p)-[rel:FAMILIA {Relacio: row.Relacio, Relacio_Harmonitzada: row.Relacio_Harmonitzada}]->(q)
